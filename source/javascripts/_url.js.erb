// Change the URL
function newURL() {
  window.history.replaceState('', 'Modularscale',
    '?' + getBase() +
    '&' + msUnit +
    '&' + document.getElementById('ratio').value +
    '&' + mode +
    '&' + outputMode
  );
}

// Query the URL on initial load
function queryURL() {
  var URL = window.location.search;

  // Ignore UTM codes if they exist in the URL
  // They conflict with the URL handilng of this tool
  if (URL.search('utm_') > 0) {
    return null
  }

  if (URL.search('&') > 0) {
    URL = URL.split('?')[1].split('&');
    if (URL.length = 5) {
      msBase     = URL[0].split(',');
      msUnit     = URL[1];
      msRatio    = URL[2];
      mode       = URL[3];
      outputMode = URL[4];

      document.getElementsByClassName('base')[0].value = msBase[0] + msUnit;
      document.getElementById('ratio').value = msRatio;

      if (msBase.length > 1) {
        for (var i = 1; i < msBase.length; i++)
          addBase(msBase[i] + msUnit);
      }

      if (isNaN(msRatio/1)) {
        msRatio = msRatio.split('@');
        if (msRatio[1] != '' && typeof(msRatio[1]/1) === 'number') {
          if (msBase.length > 1) {
            var b = msBase[Math.round(((msRatio[1]/msBase.length) - Math.floor(msRatio[1]/msBase.length))*msBase.length)];
            msRatio = Math.pow((msRatio[0]/b),(1/Math.floor(msRatio[1]/msBase.length)));
          } else {
            msRatio = Math.pow((msRatio[0]/msBase),(1/msRatio[1]));
          }
        }
      }

      msPage(msBase,msUnit,msRatio);
      codeMode(mode);
      outputM(outputMode);

    }
  }
}